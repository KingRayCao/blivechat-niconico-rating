# niconico风格弹幕投票系统

为blivechat实现类niconico风格的弹幕投票统计功能

## 功能特性

- **投票弹幕设置**: 支持为1-5级投票设置自定义正则表达式，留空则使用默认值（只匹配数字1-5）
- **设置按钮**: 输入正则表达式后需要点击"设置"按钮才会生效
- **实时统计**: 实时显示各等级投票数量和百分比
- **统计控制**: 可以设置初始人数，开始/结束统计
- **结果可视化**: 支持柱状图和饼图展示投票结果
- **自定义设置**: 可自定义结果页面的标题和副标题
- **性能优化**: 在listener层进行预过滤，只处理可能匹配的弹幕，提高性能

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

1. 启动插件后会自动打开GUI窗口
2. 在"投票弹幕设置"中配置各等级对应的正则表达式：
   - 留空文本框：使用默认值（只匹配数字1-5）
   - 输入自定义正则表达式：如 `^[1一壹]$` 匹配数字1、中文一、大写壹
3. **点击"设置"按钮**：使输入的正则表达式生效
4. 设置初始人数（可选）
5. 点击"开始统计"开始收集投票
6. 实时查看统计结果
7. 点击"结束统计"停止收集
8. 点击"显示结果"查看可视化结果

## 投票等级默认设置

- 等级1: `^1$` (只匹配数字1)
- 等级2: `^2$` (只匹配数字2)
- 等级3: `^3$` (只匹配数字3)
- 等级4: `^4$` (只匹配数字4)
- 等级5: `^5$` (只匹配数字5)

## 自定义正则表达式示例

- **多语言支持**: `^[1一壹Ⅰ]$` (匹配数字1、中文一、大写壹、罗马数字Ⅰ)
- **关键词投票**: `^(好|棒|赞|优秀|完美)$` (匹配多个关键词)
- **范围匹配**: `^[1-5]$` (匹配1到5的任意数字)
- **忽略大小写**: `^(one|ONE|One)$` (匹配one的各种大小写形式)

## 技术特点

- **wxPython架构**: 采用wxPython作为GUI框架，主线程运行GUI，网络工作线程运行asyncio
- **线程安全**: 使用wx.CallAfter确保线程间安全通信
- **简化架构**: 保持blcsdk部分的简单性，最小化改动
- **兼容性好**: 与原有blivechat插件架构保持一致
- **性能优化**:
  - 在listener层进行预过滤，避免不必要的GUI调用
  - 缓存编译后的正则表达式，提高匹配效率
  - 只处理可能匹配投票规则的弹幕消息

## 架构说明

本项目采用参考ref/native-ui的架构设计：

1. **主线程**: 运行wxPython的MainLoop，处理GUI事件
2. **网络工作线程**: 运行asyncio事件循环，处理blcsdk的网络事件
3. **线程间通信**: 使用wx.CallAfter确保从网络线程安全地更新GUI

这种架构避免了Qt的线程限制问题，提供了更好的稳定性和性能。

## 项目参考
项目参考：[blivechat](https://github.com/xfgryujk/blivechat)
